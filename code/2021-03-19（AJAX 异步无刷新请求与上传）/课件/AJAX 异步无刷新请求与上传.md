# AJAX 异步无刷新请求与上传



1、XML .HttpRequest对象的使用
2、open方法
3、异步与同步
4、send方法
5、onload事件
6、响应数据处理
7、Ajax的封装使用
8、利用Node.js搭建服务器提供数据
9、FormData对象实现文件上传
10、upload对象监听上传进度
11、批量传图片案例



## 为什么要讲今天的内容 - ajax

客户端请求 -> 服务端（node web server）处理请求 -> 处理数据（数据+模板的渲染）-> 返回渲染后的数据到前端

问题：

- 处理数据（数据+模板的渲染）：服务端需要每次对数据和模板进行渲染、占用服务端的资源。
- 如果当下获取的数据只是一个很小部分，那么为什么这一点数据，需要返回一整个渲染好的页面
- 每次请求新的内容会通过浏览器重新发送一个请求（如果是通过浏览器发送，那么得到返回的数据的，浏览器会重载整个页面）



- 服务端性能
- 用户体验



## ajax

通过浏览器提供的一个JS API，整个API可以向服务端发送请求，这个请求返回的数据将被JS所接收，然后我们就可以通过JS来控制这个数据的渲染（DOM操作）



ajax 是 浏览器提供的一个 JS API，如果要想使用ajax去获取数据，那么首先得有一个基础的页面，这个页面中会有一段js代码，这个代码就使用ajax去发送请求



## XMLHttpRequest 对象

### 创建 XMLHttpRequest 对象

let xhr = new XMLHttpRequest()



### 配置请求参数

xhr.open();



### 监听请求状态

xhr.onload……

xhr.readyStateChange事件



### 发送请求

xhr.send();



### 属性

responseText：ajax会把接收到的数据解析成字符串

这个数据如何用，需要去分析这个数据的类型和结构，如何根据不同的结构去进行后续的处理



## 同步请求和异步请求的问题

xhr 对象请求过程有两种模式：

- 异步
  - 浏览器会启用另外一个线程且无阻塞去完成请求工作，请求工作完成以后，会把回调函数添加到任务执行队列中
- 同步
  - 浏览器会启用另外一个线程且阻塞去完成请求工作，浏览器主线程会等待这个请求工作的完成，才继续执行

我们可以通过 xhr.open 的第三个参数来设置请求的模式

- true: 异步，默认为 true
- false：同步